"use strict";angular.module("newSomEnergiaWebformsApp",["ngCookies","ngResource","ngSanitize","ngRoute","pascalprecht.translate"]).config(["$httpProvider",function(a){a.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},a.defaults.transformRequest=function(a){return void 0===a?a:jQuery.param(a)}}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/:locale",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).config(["$translateProvider",function(a){a.translations("es",{SELECCIONA:"Selecciona",SELECCIONA_PARTICULAR:"Particular",SELECCIONA_EMPRESA:"Empresa",OBLIGATORI:"Obligatorio",IDIOMA:"Idioma",SELECCIONA_IDIOMA:"Selecciona idioma",NOM:"Nombre",COGNOMS:"Apellidos",RAO_SOCIAL:"Razón social",PERSONA_REPRESENTANT:"Persona representante",REPETEIX_EMAIL:"Repetir email",TELEFON:"Teléfono",ADRECA:"Dirección",CODI_POSTAL:"Código postal",PROVINCIA:"Província",POBLACIO:"Población",ACCEPTO_POLITICA_PRIVACITAT:'Acepto la <strong><a target="_blank" href="#">política de privacidad</a></strong> de Som Energia',METODE_PAGAMENT:"Forma de pago",REBUT_BANCARI:"Recibo bancario",TARGETA_CREDIT:"Tarjeta de crédito",COST:"Coste para la cooperativa",INFO_APORTACIO:"La aportación para ser socio/a son 100€<br/>Los 100€ se pagan una sola vez, no hay cuota anual y son retornables si te das de baja.",FINALITZA_PROCES:"Finaliza el proceso",FORMULARI_NO_DISPONIBLE:"Formulario no disponible, disculpen las moléstias."}).translations("ca",{SELECCIONA:"Sel·lecciona",SELECCIONA_PARTICULAR:"Particular",SELECCIONA_EMPRESA:"Empresa",OBLIGATORI:"Obligatori",IDIOMA:"Idioma",SELECCIONA_IDIOMA:"Sel·lecciona idioma",NOM:"Nom",COGNOMS:"Cognoms",RAO_SOCIAL:"Raó social",PERSONA_REPRESENTANT:"Persona representant",REPETEIX_EMAIL:"Repeteix email",TELEFON:"Telèfon",ADRECA:"Adreça",CODI_POSTAL:"Codi postal",PROVINCIA:"Provincia",POBLACIO:"Població",ACCEPTO_POLITICA_PRIVACITAT:'Accepto la <strong><a target="_blank" href="#">política de privacitat</a></strong> de Som Energia',METODE_PAGAMENT:"Mètode de pagament",REBUT_BANCARI:"Rebut bancari",TARGETA_CREDIT:"Targeta de crèdit",COST:"Cost per a la cooperativa",INFO_APORTACIO:"L'aportació per a esdevenir soci/a són 100€<br/>Els 100€ es paguen una sola vegada, no hi ha quota anual i són retornables si et dones de baixa.",FINALITZA_PROCES:"Finalitza el procés",FORMULARI_NO_DISPONIBLE:"Formulari no disponible, disculpeu les molèsties."}).preferredLanguage("ca")}]).constant("cfg",{API_BASE_URL:"http://somenergia-api-webforms.gisce.net/",STATUS_OFFLINE:"OFFLINE",STATUS_ONLINE:"ONLINE",STATE_TRUE:!0,STATE_FALSE:!1,PAYMENT_METHOD_BANK_ACCOUNT:"rebut",PAYMENT_METHOD_CREDIT_CARD:"tpv",USER_TYPE_PERSON:"fisica",USER_TYPE_COMPANY:"juridica"}),angular.module("newSomEnergiaWebformsApp").controller("MainCtrl",["cfg","$scope","$http","$routeParams","$translate","$log",function(a,b,c,d,e,f){c.get(a.API_BASE_URL+"data/provincies").success(function(c){c.status===a.STATUS_ONLINE?c.state===a.STATE_TRUE?b.provinces=c.data.provincies:(f.error("data/provinces error response recived",c),b.showErrorDialog("GET provincies return false state (ref.003-001)")):b.showErrorDialog(c.status===a.STATUS_OFFLINE?"API server status offline (ref.002-001)":"API server unknown status (ref.001-001)")}),c.get(a.API_BASE_URL+"data/idiomes").success(function(c){c.status===a.STATUS_ONLINE?c.state===a.STATE_TRUE?b.languages=c.data.idiomes:(f.error("data/idiomes error response recived",c),b.showErrorDialog("GET idiomes return false state (ref.003-002)")):b.showErrorDialog(c.status===a.STATUS_OFFLINE?"API server status offline (ref.002-002)":"API server unknown status (ref.001-002)")}),b.currentStep=1,b.step1Ready=!0,b.step2Ready=!1,b.step3Ready=!1,b.submitReady=!1,b.submitted=!1,b.userTypeClicked=!1,b.form={},b.languages=[],b.provinces=[],b.cities=[],b.language={},b.province={},b.city={},b.messages=null,void 0!==d.locale&&e.use(d.locale),b.updateSelectedCity=function(d){c.get(a.API_BASE_URL+"data/municipis/"+b.form.province.id).success(function(c){c.status===a.STATUS_ONLINE?c.state===a.STATE_TRUE?b.cities=c.data.municipis:(f.error("data/municipis/"+b.form.province.id+" response recived",c),b.showErrorDialog("GET municipis return false state (ref.003-003)")):b.showErrorDialog(c.status===a.STATUS_OFFLINE?"API server status offline (ref.002-003)":"API server unknown status (ref.001-003)")}),b.formListener(d)},b.submit=function(d){if(b.submitted=!0,d.$invalid)return null;var e={tipuspersona:"person"===b.form.usertype?a.USER_TYPE_PERSON:a.USER_TYPE_COMPANY,nom:b.form.name,cognom:b.form.surname,dni:b.form.dni,tel:b.form.phone1,tel2:b.form.phone2,email:b.form.email1,cp:b.form.postalcode,provincia:b.form.province.id,adreca:b.form.address,municipi:b.form.city.id,idioma:b.form.language.id,payment_method:"bankaccount"===b.form.usertype?a.PAYMENT_METHOD_BANK_ACCOUNT:a.PAYMENT_METHOD_CREDIT_CARD};f.log(e),c.post(a.API_BASE_URL+"form/soci/alta",e).success(function(c){c.status===a.STATUS_ONLINE?c.state===a.STATE_TRUE?f.log("POST form/soci/alta response recived",c):(f.error("form/soci/alta error response recived",c),b.messages=b.getHumanizedAPIResponse(c.data)):b.showErrorDialog(c.status===a.STATUS_OFFLINE?"API server status offline (ref.002-004)":"API server unknown status (ref.001-004)")})},b.formListener=function(a){b.step2Ready=b.userTypeClicked&&void 0!==a.language,b.step3Ready=b.step2Ready&&void 0!==a.name&&void 0!==a.surname&&void 0!==a.dni&&void 0!==a.email1&&void 0!==a.email2&&a.email1===a.email2&&void 0!==a.phone1&&void 0!==a.address&&void 0!==a.postalcode&&void 0!==a.province&&void 0!==a.city&&void 0!==a.accept&&a.accept!==!1,b.submitReady=b.step1Ready&&b.step2Ready&&b.step3Ready},b.firstUserTypeClick=function(a){b.userTypeClicked=!0,b.formListener(a)},b.showErrorDialog=function(a){b.errorMsg=a,jQuery("#api-server-offline-modal").modal({backdrop:"static",keyboard:!1,show:!0})},b.showResponseErrorDialog=function(a){b.errorMsg=a,jQuery("#api-server-response-modal").modal({show:!0})},b.getHumanizedAPIResponse=function(a){var b="";if(void 0!==a.required_fields){b=b;for(var c=0;c<a.required_fields.length;c++)b=b+" "+a.required_fields[c]}return b}}]);