<!--GLOBAL MESSAGES-->
<div ng-cloak>
<div class="row" data-ng-include data-src="'scripts/fragments/global-messages.html'"></div>

<div ng-if='developing' data-ng-include data-src="'scripts/fragments/responsive-display.html'"></div>

<div class="row">
    <div class="col-xs-12">
        <h1 class="green extra-margin" translate="CONTRACT_MODIFICATION_FORM"></h1>
    </div>
</div>

    <form name="orderForm" class="form-inline" role="form" enctype="multipart/form-data" novalidate>

            <div data-ng-show="esAlta() || (showAll && developing)">
                <div class="row extra-margin-top">
                    <div class="col-xs-12">
                        <p class="lead" translate="HELP_TARIFA_ALTA"></p>
                    </div>
                </div>
                <div class="row extra-margin-top form-group">
                    <div class="col-xs-4">
                        <label for="phases">{{ 'TIPUS_INSTALLACIO' | translate }}</label>
                    </div>
                    <div class="col-xs-8">
                        <div class='input-group has-feedback'>
                            <select class="form-control input-lg" ng-model="form.phases" required>
                                <option value='' selected>{{ 'SELECCIONA' | translate}}</option>
                                <option value="mono">{{ 'MONOFASICA_NORMAL' | translate}}</option>
                                <option value="tri">{{ 'TRIFASICA' | translate}}</option>
                            </select>
                            <span class="form-control-feedback glyphicon "  data-ng-class="{
                                'glyphicon-asterisk danger': form.phases === undefined,
                                'glyphicon-ok success': form.phases !== undefined,
                            }" style="right:4em"></span>
                            <a
                                role="button"
                                tabindex="-1"
                                class="btn btn-default input-group-addon"
                                tooltip-append-to-body="true"
                                tooltip-trigger="'focus'"
                                tooltip-placement="left"
                                uib-tooltip-html="'HELP_INSTALL_TYPE' | translate: {url: t.HELP_INSTALL_TYPE_URL }"
                                >
                                <span class="badge current small">?</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="row extra-margin-top form-group">
                    <div class="col-xs-4">
                        <label>{{ 'POTENCIA_A_CONTRACTAR' | translate }}</label>
                    </div>
                    <div class="col-xs-8">
                        <div class='input-group has-feedback'>
                            <select class="input-lg form-control" required ng-model='form.newpower' >
                                <option value='' selected>{{ 'SELECCIONA' | translate}}</option>
                                <option
                                    ng-repeat="power in availablePowers()"
                                    value="{{power}}"
                                    style="background-color: {{power > 10? '#ae7':'#df9' }}"
                                    >{{power}} kW</option>
                                <option ng-if="form.phases==='tri'" value='15'>{{ 'MES_GRAN_DE_15KW' | translate}}</option>
                            </select>
                            <span class="form-control-feedback glyphicon "  data-ng-class="{
                                'glyphicon-asterisk danger': form.newpower === undefined,
                                'glyphicon-ok success': form.newpower !== undefined,
                            }" style="right:4em"></span>
                            <a
                                role="button"
                                tabindex="-1"
                                class="btn btn-default input-group-addon"
                                tooltip-append-to-body="true"
                                tooltip-trigger="'focus'"
                                tooltip-placement="left"
                                uib-tooltip-html="'HELP_POTENCIA' | translate: {url: t.HELP_POTENCIA_URL }"
                                >
                                <span class="badge current small">?</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="row extra-margin-top" data-ng-hide="form.newpower=='15'">
                    <div class="col-xs-4">
                        {{ 'DISCRIMINACIO_HORARIA' | translate }}
                    </div>
                    <div class="col-xs-8">
                        <div class='input-group has-feedback'>
                            <select class="input-lg form-control" ng-model="form.discriminacio" required>
                                <option value='' selected>{{ 'SELECCIONA' | translate}}</option>
                                <option value='nodh'>{{ 'SENSE_DISCRIMINACIO_HORARIA' | translate}}</option>
                                <option value='dh'>{{ 'AMB_DISCRIMINACIO_HORARIA' | translate}}</option>
                            </select>
                            <span class="form-control-feedback glyphicon "  data-ng-class="{
                                'glyphicon-asterisk danger': form.discriminacio === undefined,
                                'glyphicon-ok success': form.discriminacio !== undefined,
                            }" style="right:4em"></span>
                            <a
                                role="button"
                                tabindex="-1"
                                class="btn btn-default input-group-addon"
                                tooltip-append-to-body="true"
                                tooltip-trigger="'focus'"
                                tooltip-placement="left"
                                uib-tooltip-html="'HELP_DISCRIMINACIO_HORARIA' | translate: {url: t.HELP_DISCRIMINACIO_HORARIA_URL}"
                                >
                                <span class="badge current small">?</span>
                            </a>
                        </div>
                    </div>
                </div>
                <div data-ng-if="form.newpower == '15'">
                    <div class="row from-group">
                        <div class="col-xs-4">
                            <label>{{ 'ESCULL_LA_POTENCIA_DE_CADA_PERIODE' | translate }}</label>
                        </div>
                        <div class="col-xs-7">
                            <div class='input-group has-feedback'>
                                <span class="input-group-addon">P1</span>
                                <input type="text" class="input-lg form-control" data-ng-change="formListener()" required
                                    data-ng-model="form.power" name="power"
                                    />
                                <span class="form-control-feedback glyphicon "  data-ng-class="{
                                    'glyphicon-remove danger': rate3AIsInvalid,
                                    'glyphicon-asterisk danger': form.power === undefined || form.power === '',
                                    'glyphicon-ok success': form.power !== undefined && form.power !== '',
                                }" style="right:4em"></span>
                                <span class="input-group-addon">kW</span>
                            </div>
                            <div class="input-group has-feedback">
                                <span class="input-group-addon">P2</span>
                                <input type="text" class="input-lg form-control" data-ng-change="formListener()" required
                                    name="power2" data-ng-model="form.power2" 
                                    />
                                <span class="input-group-addon">kW</span>
                                <span class="form-control-feedback glyphicon "  data-ng-class="{
                                    'glyphicon-asterisk danger': form.power2 === undefined || form.power === '',
                                    'glyphicon-remove danger': rate3AIsInvalid,
                                    'glyphicon-ok success': form.power2 !== undefined,
                                }" style="right:4em"></span>
                            </div>
                            <div class="input-group has-feedback">
                                <span class="input-group-addon">P3</span>
                                <input type="text" class="input-lg form-control" data-ng-change="formListener()" required
                                    name="power3" data-ng-model="form.power3"
                                    />
                                <span class="form-control-feedback glyphicon "  data-ng-class="{
                                    'glyphicon-remove danger': rate3AIsInvalid,
                                    'glyphicon-asterisk danger': form.power3 === undefined || form.power === '',
                                    'glyphicon-ok success': form.power3 !== undefined,
                                }" style="right:4em"></span>
                                <span class="input-group-addon">kW</span>
                            </div>
                            <span class="pull-right label label-danger" data-ng-show="formSubmitted && orderForm.power3.$error.required ">{{ 'OBLIGATORI' | translate }}</span>
                            <span class="pull-right label label-danger" data-ng-show="rate3AIsInvalid">{{ 'ALGUN_DELS_TRES_PERIODES_MAJOR_QUE_15' | translate }}</span>
                        </div>
                        <div class="col-xs-1">
                            <a
                                class='btn btn-default pull-right'
                                role="button"
                                tabindex="-1"
                                tooltip-append-to-body="true"
                                tooltip-trigger="'focus'"
                                tooltip-placement="left"
                                uib-tooltip-html="'HELP_POWER_30' | translate: {url: t.HELP_POWER_30_URL}"
                                >
                                <span class="badge current small">?</span></a>
                        </div>
                    </div>
                </div>
                <div class="row extra-margin-top" data-ng-show="form.rate !== undefined">
                    <div class="col-xs-12">
                        <div class="well" style="text-align:center">
                        <h4>{{ 'LA_TEVA_TARIFA_ES' | translate }} <span class="label label-success large">{{ form.rate }}</span></h4>
                        </div>
                    </div>
                </div>
            </div>
            <hr data-ng-show="showAll && developing" />
            <div data-ng-show="!esAlta() || (showAll && developing)">
                <div class="row extra-margin-top">
                    <div class="col-xs-12">
                        <p class="lead" translate="HELP_TARIFA_CANVI_COMERCIALITZADORA"></p>
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-xs-4">
                        <label>{{ 'QUINA_TARIFA_TENS_CONTRACTADA' | translate }}</label>
                    </div>
                    <div class="col-xs-8">
                        <div class="input-group has-feedback">
                            <select class="input-lg form-control" name="rate" data-ng-model="form.rate" required>
                                <option value="">{{ 'SELECCIONAR' | translate }}</option>
                                <option data-ng-repeat="rate in rates" value="{{ rate }}" data-ng-selected="{{ rate == form.rate }}">{{ rate }}</option>
                            </select>
                            <span class="form-control-feedback glyphicon "  data-ng-class="{
                                'glyphicon-asterisk danger': form.rate === undefined,
                                'glyphicon-ok success': form.rate !== undefined,
                            }" style="right:4em"></span>
                            <a
                                role="button"
                                tabindex="-1"
                                class="btn btn-default input-group-addon"
                                tooltip-append-to-body="true"
                                tooltip-trigger="'focus'"
                                tooltip-placement="left"
                                uib-tooltip-html="'HELP_POPOVER_RATE' | translate: {url: t.HELP_POPOVER_RATE_URL}"
                                >
                                <span class="badge current small">?</span>
                            </a>
                        </div>
                    </div>
                </div>
                <!--3.0A power rate NOT selected-->
                <div class="row form-group" data-ng-if="form.rate != '3.0A'">
                    <div class="col-xs-4">
                        <label>{{ 'QUINA_POTENCIA_TENS_CONTRACTADA' | translate }}</label>
                    </div>
                    <div class="col-xs-8">
                        <div class="input-group has-feedback">
                            <input type="text" name="power" class="form-control input-lg" data-ng-model="form.power" data-ng-change="formListener()" required/>
                            <span class="input-group-addon">kW</span>
                            <a
                                role="button"
                                tabindex="-1"
                                class="btn btn-default input-group-addon"
                                tooltip-append-to-body="true"
                                tooltip-trigger="'focus'"
                                tooltip-placement="left"
                                uib-tooltip-html="'HELP_POPOVER_POWER' | translate"
                                >
                                <span class="badge current small">?</span>
                            </a>
                            <span class="form-control-feedback glyphicon "  data-ng-class="{
                                'glyphicon-asterisk danger': form.power === undefined,
                                'glyphicon-ok success': form.power !== undefined,
                            }" style="right:7em"></span>
                        </div>
                        <span class="pull-right label label-danger" data-ng-show="rate20IsInvalid">{{ 'INVALID' | translate }}</span>
                        <span class="pull-right label label-danger" data-ng-show="rate21IsInvalid">{{ 'INVALID' | translate }}</span>
                        <span class="pull-right label label-danger" data-ng-show="formSubmitted && orderForm.power.$error.required">{{ 'OBLIGATORI' | translate }}</span>
                    </div>
                </div>
                <!--3.0A power rate selected-->
                <div data-ng-if="form.rate == '3.0A'">
                    <div class="row from-group">
                        <div class="col-xs-4">
                            <label>{{ 'QUINA_POTENCIA_TENS_CONTRACTADA' | translate }}*</label>
                        </div>
                        <div class="col-xs-7">
                            <div class='input-group has-feedback'>
                                <span class="input-group-addon">P1</span>
                                <input type="text" class="input-lg form-control" data-ng-change="formListener()" required
                                    data-ng-model="form.power" name="power"
                                    />
                                <span class="form-control-feedback glyphicon "  data-ng-class="{
                                    'glyphicon-remove danger': rate3AIsInvalid,
                                    'glyphicon-asterisk danger': form.power === undefined || form.power === '',
                                    'glyphicon-ok success': form.power !== undefined && form.power !== '',
                                }" style="right:4em"></span>
                                <span class="input-group-addon">kW</span>
                            </div>
                            <div class="input-group has-feedback">
                                <span class="input-group-addon">P2</span>
                                <input type="text" class="input-lg form-control" data-ng-change="formListener()" required
                                    name="power2" data-ng-model="form.power2" 
                                    />
                                <span class="input-group-addon">kW</span>
                                <span class="form-control-feedback glyphicon "  data-ng-class="{
                                    'glyphicon-asterisk danger': form.power2 === undefined || form.power === '',
                                    'glyphicon-remove danger': rate3AIsInvalid,
                                    'glyphicon-ok success': form.power2 !== undefined,
                                }" style="right:4em"></span>
                            </div>
                            <div class="input-group has-feedback">
                                <span class="input-group-addon">P3</span>
                                <input type="text" class="input-lg form-control" data-ng-change="formListener()" required
                                    name="power3" data-ng-model="form.power3"
                                    />
                                <span class="form-control-feedback glyphicon "  data-ng-class="{
                                    'glyphicon-remove danger': rate3AIsInvalid,
                                    'glyphicon-asterisk danger': form.power3 === undefined || form.power === '',
                                    'glyphicon-ok success': form.power3 !== undefined,
                                }" style="right:4em"></span>
                                <span class="input-group-addon">kW</span>
                            </div>
                            <span class="pull-right label label-danger" data-ng-show="formSubmitted && orderForm.power3.$error.required ">{{ 'OBLIGATORI' | translate }}</span>
                            <span class="pull-right label label-danger" data-ng-show="rate3AIsInvalid">{{ 'ALGUN_DELS_TRES_PERIODES_MAJOR_QUE_15' | translate }}</span>
                        </div>
                        <div class="col-xs-1">
                            <a
                                class='btn btn-default pull-right'
                                role="button"
                                tabindex="-1"
                                tooltip-append-to-body="true"
                                tooltip-trigger="'focus'"
                                tooltip-placement="left"
                                uib-tooltip-html="'HELP_POWER_30' | translate: {url: t.HELP_POWER_30_URL}"
                                >
                                <span class="badge current small">?</span></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row extra-margin-top" data-ng-show="farePageError">
                <div class="alert alert-danger" translate="{{farePageError}}"></div>
            </div>

            <div class="row no-margin-bottom">
                <div class="col-xs-12">
                    <div class="wrapper-continue-process" data-ng-class="{ready: isFarePageComplete()}">
                        <button
                            data-ng-disabled="!isFarePageComplete()"
                            data-ng-click="submit()"
                            class="btn btn-default transparent pull-right submit"
                            type="button">{{ 'FINALITZA_PROCES' | translate }}</button>
                    </div>
                </div>
            </div>

    </form>

</div>
